{% extends "patients/base.html" %}
{% block content %}
<section class="container">
  <h2>Patient Dashboard</h2>

  <!-- Quick Info Cards -->
  <div class="grid quick-info-grid" style="margin-top: 2rem; gap: 1.5rem;">
    <div class="card info-card">
      <div class="info-icon">ğŸ©º</div>
      <h3>Name</h3>
      <p>{{ session.get('patient_name', 'John Doe') }}</p>
    </div>
    <div class="card info-card">
      <div class="info-icon">ğŸ“§</div>
      <h3>Email</h3>
      <p>{{ session.get('patient_email', 'example@email.com') }}</p>
    </div>
    <div class="card info-card">
      <div class="info-icon">ğŸ“…</div>
      <h3>Appointments</h3>
      <p>{{ appointments|length if appointments else 0 }}</p>
    </div>
    <div class="card info-card">
      <div class="info-icon">âš•ï¸</div>
      <h3>Last Visit</h3>
      <p>{{ last_visit or 'N/A' }}</p>
    </div>
  </div>

<!-- Actions -->
<div class="grid action-grid" style="margin-top: 3rem; gap: 1.5rem;">
    <!-- Anchor link to embedded appointment form -->
    <a href="#appointment" class="card action-card">
      <div class="action-icon">ğŸ“…</div>
      <h3>Book Appointment</h3>
    </a>
    <!-- Temporary placeholders -->
    <a href="#" class="card action-card">
      <div class="action-icon">ğŸ“</div>
      <h3>Check Appointments</h3>
    </a>
    <a href="#" class="card action-card">
      <div class="action-icon">âœ‰ï¸</div>
      <h3>Contact Doctor</h3>
    </a>
    <a href="#" class="card action-card">
      <div class="action-icon">ğŸ“‚</div>
      <h3>Medical History</h3>
    </a>
</div>


  <!-- Upcoming Appointments -->
  <h3 style="margin-top:3rem;">Upcoming Appointments</h3>
  <div class="grid" style="gap: 1.5rem;">
    {% if appointments %}
      {% for appt in appointments %}
        <div class="card">
          <h4>{{ appt.service }}</h4>
          <p><strong>Date:</strong> {{ appt.appointment_date }}</p>
          <p><strong>Time:</strong> {{ appt.appointment_time }}</p>
          <p><strong>Status:</strong> 
            <span class="status-badge 
              {% if appt.status=='Pending' %}status-pending
              {% elif appt.status=='Confirmed' %}status-confirmed
              {% elif appt.status=='Cancelled' %}status-cancelled
              {% elif appt.status=='Completed' %}status-completed
              {% endif %}">
              {{ appt.status }}
            </span>
          </p>
        </div>
      {% endfor %}
    {% else %}
      <div class="card" style="text-align:center;">
        <p>No upcoming appointments.</p>
      </div>
    {% endif %}
  </div>

  <!-- Embedded Appointment Form -->
  <section id="appointment" class="appointment" style="margin-top:3rem;">
    <h2>Book an Appointment</h2>
    <form method="POST" action="{{ url_for('patients.dashboard') }}" class="appt-form">
      <div class="form-group">
        <input name="name" placeholder="Full name" pattern="[A-Za-z\s]+" title="Only letters allowed" required>
        <div style="display:flex; gap:0.5rem; align-items:center;">
          <select name="country_code" required>
            <option value="+260">ğŸ‡¿ğŸ‡² +260</option>
            <option value="+27">ğŸ‡¿ğŸ‡¦ +27</option>
            <option value="+255">ğŸ‡¹ğŸ‡¿ +255</option>
            <option value="+256">ğŸ‡ºğŸ‡¬ +256</option>
            <option value="+254">ğŸ‡°ğŸ‡ª +254</option>
          </select>
          <input name="phone" type="tel" placeholder="Phone number" pattern="[0-9]{6,12}" title="Enter digits only" required>
        </div>
      </div>
      <div class="form-group">
        <input name="email" type="email" placeholder="Email (optional)">
        <select name="service">
          <option value="">Select Service (optional)</option>
          {% for s in ['General Consultation','Dental','Physiotherapy','Diagnostics','Mobile Health'] %}
            <option value="{{ s }}">{{ s }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="form-group">
        <label for="date" style="font-size:0.9rem; color:var(--text-dark);" required>Appointment Date</label>
        <input id="date" type="date" name="date" required>
        <label for="time" style="font-size:0.9rem; color:var(--text-dark);" required>Appointment Time</label>
        <input id="time" type="time" name="time" required>
      </div>
      <textarea name="message" placeholder="Reason for visit (optional)"></textarea>
      <div class="form-actions">
        <button type="submit" class="btn primary">Submit Booking</button>
        <a class="btn outline" href="https://wa.me/260965318772?text=I%20want%20to%20book%20an%20appointment" target="_blank">
          Book by WhatsApp
        </a>
      </div>
    </form>
  </section>
</section>
{% endblock %}
