{% extends "patients/base.html" %}
{% block content %}
<section class="container">
  <h2>Patient Dashboard</h2>

  <!-- Quick Info Cards -->
  <div class="grid quick-info-grid" style="margin-top: 2rem; gap: 1.5rem;">
    <div class="card info-card">
      <div class="info-icon">ğŸ©º</div>
      <h3>Name</h3>
      <p>{{ session.get('patient_name', 'John Doe') }}</p>
    </div>
    <div class="card info-card">
      <div class="info-icon">ğŸ“§</div>
      <h3>Email</h3>
      <p>{{ session.get('patient_email', 'example@email.com') }}</p>
    </div>
    <div class="card info-card">
      <div class="info-icon">ğŸ“…</div>
      <h3>Appointments</h3>
      <p>{{ upcoming_appointments|length if upcoming_appointments else 0 }}</p>
    </div>
    <div class="card info-card">
      <div class="info-icon">âš•ï¸</div>
      <h3>Last Visit</h3>
      <p>{{ last_visit or 'N/A' }}</p>
    </div>
  </div>

  <!-- Actions -->
  <div class="grid action-grid" style="margin-top: 3rem; gap: 1.5rem;">
      <a href="#appointment" class="card action-card">
        <div class="action-icon">ğŸ“…</div>
        <h3>Book Appointment</h3>
      </a>
      <a href="#" class="card action-card">
        <div class="action-icon">ğŸ“</div>
        <h3>Check Appointments</h3>
      </a>
      <a href="#" class="card action-card">
        <div class="action-icon">âœ‰ï¸</div>
        <h3>Contact Doctor</h3>
      </a>
      <a href="#" class="card action-card">
        <div class="action-icon">ğŸ“‚</div>
        <h3>Medical History</h3>
      </a>
  </div>

  <!-- Upcoming Appointments -->
  <h3 style="margin-top:3rem;">Upcoming Appointments</h3>
  <div class="grid" style="gap: 1.5rem;">
    {% if upcoming_appointments %}
      {% for appt in upcoming_appointments %}
        <div class="card">
          <h4>{{ appt.service }}</h4>
          <p><strong>Date:</strong> {{ appt.appointment_date }}</p>
          <p><strong>Time:</strong> {{ appt.appointment_time }}</p>
          <p><strong>Status:</strong> 
            <span class="status-badge 
              {% if appt.status=='Pending' %}status-pending
              {% elif appt.status=='Confirmed' %}status-confirmed
              {% endif %}">
              {{ appt.status }}
            </span>
          </p>
          {% if appt.status == 'Pending' %}
            <form method="POST" action="{{ url_for('patients.cancel_appointment', appt_id=appt.id) }}">
              <button type="submit" class="btn outline" style="margin-top: 0.5rem;">Cancel</button>
            </form>
          {% endif %}
        </div>
      {% endfor %}
    {% else %}
      <div class="card" style="text-align:center;">
        <p>No upcoming appointments.</p>
      </div>
    {% endif %}
  </div>

  <!-- Past Appointments -->
  <h3 style="margin-top:3rem;">Past Appointments</h3>
  <div class="grid" style="gap: 1.5rem;">
    {% if past_appointments %}
      {% for appt in past_appointments %}
        <div class="card">
          <h4>{{ appt.service }}</h4>
          <p><strong>Date:</strong> {{ appt.appointment_date }}</p>
          <p><strong>Time:</strong> {{ appt.appointment_time }}</p>
          <p><strong>Status:</strong> 
            <span class="status-badge 
              {% if appt.status=='Completed' %}status-completed
              {% elif appt.status=='Cancelled' %}status-cancelled
              {% endif %}">
              {{ appt.status }}
            </span>
          </p>
        </div>
      {% endfor %}
    {% else %}
      <div class="card" style="text-align:center;">
        <p>No past appointments.</p>
      </div>
    {% endif %}
  </div>

  <!-- Appointment Form -->
  <section id="appointment" class="appointment" style="margin-top:3rem;">
    <h2>Book an Appointment</h2>
    <form method="POST" action="{{ url_for('patients.dashboard') }}" class="appt-form">
      <div class="form-group">
        <label for="service">Service</label>
        <select name="service" id="service" required>
          <option value="">Select Service</option>
          {% for s in ['General Consultation','Dental','Physiotherapy','Diagnostics','Mobile Health'] %}
            <option value="{{ s }}">{{ s }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="form-group">
        <label for="date">Appointment Date</label>
        <input id="date" type="date" name="date" required>
        <label for="time">Appointment Time</label>
        <input id="time" type="time" name="time" required>
      </div>
      <div class="form-group">
        <textarea name="message" placeholder="Reason for visit (optional)"></textarea>
      </div>
      <div class="form-actions">
        <button type="submit" class="btn primary">Submit Booking</button>
        <a class="btn outline" href="https://wa.me/260965318772?text=I%20want%20to%20book%20an%20appointment" target="_blank">
          Book by WhatsApp
        </a>
      </div>
    </form>
  </section>
</section>
{% endblock %}
